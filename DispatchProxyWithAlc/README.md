# Dispatch Proxy with ALC

This repro demonstrates problems with using DispatchProxy with mulitple custom AssemblyLoadContext instances. There are 2 bugs in DispatchProxy.

### DispatchProxy generates proxy type in the ALC of the proxyType preventing usage of a collectable ALC
This affects users of WCF. The only assemblies loaded in the ALC are ones explicitly loaded into it. There is an assumption in the implementation of DispatchProxy that the base proxyType is representative of where to generate the proxy. Take the scenario of an application with a plugin mechanism to dynamically load a module. That module uses WCF. There's no need to explicitly load the WCF assembly into the custom ALC as it's a common library. Although shipped OOB, it's still often treated as though it's part of the runtime. E.g. Powershell Core ships with the WCF client libraries. WCF has a derived implementation of DispatchProxy to create client channels, ServiceChannelProxy. If the service contract is loaded into a custom ALC, and ServiceChannelProxy is loaded in the default ALC, if the custom ALC is collectible, an exception will be thrown when trying to generate a proxy. This is because generating a dispatch proxy type which is in a non-collectible ALC (ie the default one) that implements an interface from a collectible ALC would permanently root the collectible ALC and make it non-collectible. At least for the WCF usage, you should really care more about the location of the interface type.

### DispatchProxy generates a proxy type implementing the interface from the wrong ALC
Inside a custom ALC, I create a proxy for type IFoo, which is loaded into the custom ALC. Inside a second ALC, I also create a proxy for the same interface type IFoo, but loaded into the second ALC. The second proxy is generated implementing the interface from the first ALC, which code in the second ALC is unable to cast. If you use the generic overload of DispatchProxy.Create, you get an invalid cast exception as it attempts to return the strongly typed proxy by casting it.